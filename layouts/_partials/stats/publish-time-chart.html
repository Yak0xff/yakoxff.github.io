{{/* å®šä¹‰æ—¶é—´æ®µ */}}
{{ $fuzzyTimes := slice
    (dict "limit" 5  "label" "å‡Œæ™¨" "class" "dawn")
    (dict "limit" 11 "label" "æ—©ä¸Š" "class" "morning")
    (dict "limit" 13 "label" "ä¸­åˆ" "class" "noon")
    (dict "limit" 17 "label" "ä¸‹åˆ" "class" "afternoon")
    (dict "limit" 22 "label" "æ™šä¸Š" "class" "night")
    (dict "limit" 24 "label" "æ·±å¤œ" "class" "late-night")
}}

{{/* åˆå§‹åŒ–æ—¶é—´æ®µè®¡æ•° */}}
{{ $timeCounts := dict
    "å‡Œæ™¨" 0
    "æ¸…æ™¨" 0
    "æ—©ä¸Š" 0
    "ä¸­åˆ" 0
    "ä¸‹åˆ" 0
    "å‚æ™š" 0
    "æ™šä¸Š" 0
    "æ·±å¤œ" 0
}}

{{/* ç»Ÿè®¡æ¯ä¸ªæ—¶é—´æ®µçš„æ–‡ç« æ•°é‡ */}}
{{ $total := 0 }}
{{ range .Site.RegularPages }}
    {{ if .Date }}
        {{ $hour := .Date.Hour }}
        {{ $fuzzyTime := "æ·±å¤œ" }}
        {{ range $fuzzyTimes }}
            {{ if lt $hour .limit }}
                {{ $fuzzyTime = .label }}
                {{ break }}
            {{ end }}
        {{ end }}
        {{ $total = add $total 1 }}
        {{ $currentCount := index $timeCounts $fuzzyTime }}
        {{ $timeCounts = merge $timeCounts (dict $fuzzyTime (add $currentCount 1)) }}
    {{ end }}
{{ end }}

<div class="w-full max-w-[700px] my-4">
    <div class="flex items-center gap-4 mb-4">
        <div class="text-size-2xl flex-shrink-0">â˜€ï¸</div>
        <div class="flex gap-2 w-full h-6 dark:invert">
            {{ range $fuzzyTimes }}
                {{ $count := index $timeCounts .label }}
                {{ if gt $total 0 }}
                    {{ $percentage := div (mul $count 100.0) $total }}
                    {{ if gt $count 0 }}
                        <div class="flex items-center justify-center
                           text-white rounded-2xl text-size-sm font-500 relative
                           bg-black opacity-{{ add (mul (int (div $percentage 10)) 10) 30 }}
                           {{ .class }}"
                             style="width: {{ printf "%.1f" $percentage }}%;"
                             title="{{ .label }}: {{ $count }}ç¯‡ ({{ printf "%.1f" $percentage }}%)">
                            {{ if gt $percentage 8 }}{{ .label }}{{ end }}
                        </div>
                    {{ end }}
                {{ end }}
            {{ end }}
        </div>
        <div class="text-size-2xl flex-shrink-0">ğŸŒ™</div>
    </div>

    <div class="flex gap-2 mt-2 px-10">
        {{ range $fuzzyTimes }}
            {{ $count := index $timeCounts .label }}
            {{ if gt $count 0 }}
                {{ $percentage := div (mul $count 100.0) $total }}
                <div class="flex flex-col items-center text-size-xs
                    text-secondary font-mono"
                    style="width: {{ printf "%.1f" $percentage }}%;">
                    <span class="font-600 text-[var(--primary-text-color)]">{{ $count }}</span>
                </div>
            {{ end }}
        {{ end }}
    </div>
</div>
