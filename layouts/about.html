{{ define "main" }}
{{ $about := site.Data.about }}
<article class="about-page">
    {{ partial "header" . }}
    
    <!-- é¡µé¢æ ‡é¢˜ -->
    <h1 class="about-title">{{ .Title }}</h1>
    
    <!-- è‡´è°¢æç¤º -->
    <div class="about-callout">
        <span class="callout-icon">ğŸ«¡</span>
        <p>ç”±è¡·çš„è‡´è°¢ã€Œ<a href="https://www.geedea.pro/" target="_blank">æ¥µå®¢æ­»äº¡è¨ˆåŠƒ</a>ã€ã€‚ä½ ä¼šå‘ç°è¿™ä¸ªåšå®¢å’Œä»–å¾ˆåƒï¼Œä¸å¯å¦è®¤è¿™é‡Œä½¿ç”¨äº†ä»–çš„ä¸»é¢˜ã€‚å¾ˆä¹…æ²¡æœ‰è§‰å¾—ä¸€ä¸ªåšå®¢ä¸»é¢˜å’Œå†…å®¹è¿™ä¹ˆæ‘„äººå¿ƒæ‰‰å•¦ï¼Œå¾ˆç¾¡æ…•<a href="https://www.guhub.cn/" target="_blank">Eltrec</a>å¦‚æ­¤æœ‰å­¦è¯†ï¼Œè‡ªå¹ä¸å¦‚ã€‚</p>
    </div>

    <!-- ç®€ä»‹ -->
    {{ with $about.intro }}
    <section class="about-intro">
        <p>{{ . | markdownify }}</p>
    </section>
    {{ end }}

    <!-- å†™ä½œè´¡çŒ®å›¾ -->
    <section class="about-section">
        <h2><span class="section-icon">ğŸ“</span> å†™ä½œè®°å½•</h2>
        <div class="contributions-wrapper">
            <div class="contributions-graph-monthly" id="contributions-graph"></div>
            <div class="contrib-legend">
                <span class="contrib-total" id="contrib-total"></span>
                <div class="legend-scale">
                    <span>å°‘</span>
                    <span class="legend-cell" data-level="0"></span>
                    <span class="legend-cell" data-level="1"></span>
                    <span class="legend-cell" data-level="2"></span>
                    <span class="legend-cell" data-level="3"></span>
                    <span class="legend-cell" data-level="4"></span>
                    <span>å¤š</span>
                </div>
            </div>
        </div>
    </section>

    <!-- å†…å®¹å‘å¸ƒæ•°æ®ï¼ˆHugo ç”Ÿæˆï¼Œç»Ÿè®¡ posts sectionï¼‰ -->
    <script id="posts-data" type="application/json">
    {
        {{- $allPages := where site.RegularPages "Section" "posts" -}}
        {{- $dateMap := dict -}}
        {{- range $allPages -}}
            {{- $dateStr := .Date.Format "2006-01-02" -}}
            {{- if isset $dateMap $dateStr -}}
                {{- $dateMap = merge $dateMap (dict $dateStr (add (index $dateMap $dateStr) 1)) -}}
            {{- else -}}
                {{- $dateMap = merge $dateMap (dict $dateStr 1) -}}
            {{- end -}}
        {{- end -}}
        {{- $first := true -}}
        {{- range $date, $count := $dateMap -}}
            {{- if not $first }},{{ end -}}
            "{{ $date }}": {{ $count }}
            {{- $first = false -}}
        {{- end -}}
    }
    </script>

    <!-- æ­£åœ¨... -->
    {{ with $about.currently }}
    <section class="about-section">
        <h2><span class="section-icon">âœ¨</span> æ­£åœ¨...</h2>
        <div class="bento-grid">
            {{ range $i, $item := . }}
            <div class="bento-item{{ if eq $i 0 }} bento-featured{{ end }}">
                <div class="bento-header">
                    <span class="bento-icon">{{ $item.svg | safeHTML }}</span>
                    <span class="bento-label">{{ $item.label }}</span>
                </div>
                <span class="bento-value">{{ $item.value }}</span>
            </div>
            {{ end }}
        </div>
    </section>
    {{ end }}

    <!-- é¸£è°¢ -->
    {{ with $about.credits }}
    <section class="about-section">
        <h2><span class="section-icon">ğŸ™</span> é¸£è°¢</h2>
        {{ range . }}
        <div class="credits-group">
            <h3>{{ .title }}</h3>
            <ul class="credits-list">
                {{ range .items }}
                <li>
                    <strong>{{ .name }}</strong>: 
                    <a href="{{ .link }}" target="_blank">{{ .source }}</a>
                </li>
                {{ end }}
            </ul>
        </div>
        {{ end }}
    </section>
    {{ end }}

    <!-- æ­£æ–‡å†…å®¹ -->
    {{ with .Content }}
    <section class="about-content markdown-body">
        {{ . }}
    </section>
    {{ end }}
</article>

<style>
.about-page {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 1rem;
}

.about-title {
    font-size: 2.25rem;
    font-weight: bold;
    color: var(--text-color);
    margin-bottom: 1.5rem;
}

.about-callout {
    display: flex;
    gap: 1rem;
    padding: 1rem 1.25rem;
    background: var(--block-background-color);
    border-radius: 8px;
    margin-bottom: 2rem;
    align-items: flex-start;
}

.callout-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.about-callout p {
    margin: 0;
    color: var(--text-color);
    line-height: 1.6;
}

.about-callout a {
    color: var(--link-color);
    text-decoration: underline;
    text-decoration-style: wavy;
    text-underline-offset: 0.2em;
    text-decoration-color: var(--border-color);
}

.about-intro {
    font-size: 1.15rem;
    line-height: 1.8;
    color: var(--text-color);
    margin-bottom: 2.5rem;
    font-family: var(--serif-font-family);
}

.about-section {
    margin-bottom: 2.5rem;
}

.about-section h2 {
    font-size: 1.5rem;
    color: var(--text-color);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-icon {
    font-size: 1.25rem;
}

/* è´¡çŒ®å›¾æ ·å¼ - æŒ‰æœˆåˆ†ç»„ */
.contributions-wrapper {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
    overflow-x: auto;
}

.contributions-graph-monthly {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}

.contrib-month-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.contrib-month-label {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-color);
    margin-bottom: 4px;
    text-align: center;
}

.contrib-month-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 3px;
}

.contrib-day-header {
    font-size: 0.6rem;
    color: var(--secondary-text-color);
    text-align: center;
    padding-bottom: 2px;
}

.contrib-cell {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    background: var(--contrib-level-0);
    cursor: pointer;
    position: relative;
}

.contrib-cell.empty {
    background: transparent;
    cursor: default;
}

.contrib-cell:not(.empty):hover {
    outline: 1px solid var(--secondary-text-color);
    outline-offset: -1px;
}

.contrib-cell[data-level="1"] { background: var(--contrib-level-1); }
.contrib-cell[data-level="2"] { background: var(--contrib-level-2); }
.contrib-cell[data-level="3"] { background: var(--contrib-level-3); }
.contrib-cell[data-level="4"] { background: var(--contrib-level-4); }

/* è´¡çŒ®å›¾é¢œè‰² - æµ…è‰²æ¨¡å¼ */
:root {
    --contrib-level-0: #ebedf0;
    --contrib-level-1: #9be9a8;
    --contrib-level-2: #40c463;
    --contrib-level-3: #30a14e;
    --contrib-level-4: #216e39;
}

/* è´¡çŒ®å›¾é¢œè‰² - æ·±è‰²æ¨¡å¼ */
html.dark {
    --contrib-level-0: #161b22;
    --contrib-level-1: #0e4429;
    --contrib-level-2: #006d32;
    --contrib-level-3: #26a641;
    --contrib-level-4: #39d353;
}

@media (prefers-color-scheme: dark) {
    html:not(.light) {
        --contrib-level-0: #161b22;
        --contrib-level-1: #0e4429;
        --contrib-level-2: #006d32;
        --contrib-level-3: #26a641;
        --contrib-level-4: #39d353;
    }
}

.contrib-legend {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.75rem;
    font-size: 0.75rem;
    color: var(--secondary-text-color);
}

.legend-scale {
    display: flex;
    align-items: center;
    gap: 3px;
}

.legend-cell {
    width: 11px;
    height: 11px;
    border-radius: 2px;
    background: var(--contrib-level-0);
}

.legend-cell[data-level="1"] { background: var(--contrib-level-1); }
.legend-cell[data-level="2"] { background: var(--contrib-level-2); }
.legend-cell[data-level="3"] { background: var(--contrib-level-3); }
.legend-cell[data-level="4"] { background: var(--contrib-level-4); }

/* Tooltip */
.contrib-tooltip {
    position: fixed;
    background: var(--text-color);
    color: var(--background-color);
    padding: 0.4rem 0.6rem;
    border-radius: 4px;
    font-size: 0.75rem;
    pointer-events: none;
    z-index: 1000;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.15s;
}

.contrib-tooltip.visible {
    opacity: 1;
}

/* Bento Grid */
.bento-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.75rem;
}

.bento-item {
    background: var(--block-background-color);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1rem 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.bento-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
}

html.dark .bento-item:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
}

/* ç¬¬ä¸€ä¸ªå¡ç‰‡çªå‡ºæ˜¾ç¤º */
.bento-featured {
    grid-column: span 2;
}

.bento-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.bento-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--secondary-text-color);
    flex-shrink: 0;
}

.bento-icon svg {
    width: 18px;
    height: 18px;
}

.bento-label {
    font-size: 0.8rem;
    color: var(--secondary-text-color);
    font-weight: 500;
}

.bento-value {
    font-size: 1.05rem;
    color: var(--text-color);
    font-weight: 600;
    line-height: 1.4;
}

.bento-featured .bento-value {
    font-size: 1.2rem;
}

/* å“åº”å¼ */
@media (max-width: 640px) {
    .bento-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .bento-featured {
        grid-column: span 2;
    }
    
    .bento-item {
        min-height: 100px;
        padding: 1rem;
    }
}

@media (max-width: 400px) {
    .bento-grid {
        grid-template-columns: 1fr;
    }
    
    .bento-featured {
        grid-column: span 1;
    }
}

/* é¸£è°¢ */
.credits-group {
    margin-bottom: 1.5rem;
}

.credits-group h3 {
    font-size: 1rem;
    color: var(--secondary-text-color);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.credits-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.credits-list li {
    padding: 0.35rem 0;
    color: var(--text-color);
    font-size: 0.95rem;
}

.credits-list a {
    color: var(--link-color);
    text-decoration: underline;
    text-decoration-style: wavy;
    text-underline-offset: 0.2em;
    text-decoration-color: var(--border-color);
}

.about-content {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
}

/* å“åº”å¼ */
@media (max-width: 640px) {
    .about-title {
        font-size: 1.75rem;
    }
    
    .about-callout {
        flex-direction: column;
        gap: 0.5rem;
    }
}
</style>

<script>
(function() {
    // è·å–æ–‡ç« å‘å¸ƒæ•°æ®
    const postsDataEl = document.getElementById('posts-data');
    const postsData = postsDataEl ? JSON.parse(postsDataEl.textContent) : {};
    
    const today = new Date();
    // è®¡ç®—è¿‡å»12ä¸ªæœˆçš„èµ·å§‹æ—¥æœŸï¼ˆåŒ…æ‹¬å½“å‰æœˆï¼‰
    const startMonth = new Date(today.getFullYear(), today.getMonth() - 11, 1);
    
    // ç”Ÿæˆæœˆä»½æ•°æ®
    const monthGroups = [];
    let totalPosts = 0;
    
    const monthNames = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
    
    let current = new Date(startMonth);
    let prevYear = null;
    
    for (let i = 0; i < 12; i++) {
        const year = current.getFullYear();
        const month = current.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        
        // ç”Ÿæˆæœˆä»½æ ‡ç­¾ï¼ˆå¦‚æœå¹´ä»½å˜åŒ–ï¼Œæ˜¾ç¤ºå¹´ä»½ï¼‰
        let monthLabel = monthNames[month];
        if (prevYear !== null && prevYear !== year) {
            monthLabel = `${year}å¹´${monthLabel}`;
        } else if (i === 0) {
            // ç¬¬ä¸€ä¸ªæœˆä»½ï¼Œå¦‚æœå¹´ä»½ä¸æ˜¯å½“å‰å¹´ï¼Œæ˜¾ç¤ºå¹´ä»½
            if (year !== today.getFullYear()) {
                monthLabel = `${year}å¹´${monthLabel}`;
            }
        }
        prevYear = year;
        
        // è®¡ç®—ç¬¬ä¸€å¤©çš„æ˜ŸæœŸåç§»ï¼ˆå‘¨ä¸€ä½œä¸ºç¬¬ä¸€åˆ—ï¼‰
        const firstDayOfWeek = firstDay.getDay();
        const offset = (firstDayOfWeek + 6) % 7; // 0=å‘¨ä¸€, 1=å‘¨äºŒ, ..., 6=å‘¨æ—¥
        
        const days = [];
        
        // æ·»åŠ ç©ºç™½æ ¼å­ç›´åˆ°å‘¨ä¸€
        for (let j = 0; j < offset; j++) {
            days.push({ type: 'empty' });
        }
        
        // æ·»åŠ è¯¥æœˆçš„æ¯ä¸€å¤©
        for (let day = 1; day <= lastDay.getDate(); day++) {
            const date = new Date(year, month, day);
            // å¦‚æœæ—¥æœŸè¶…è¿‡ä»Šå¤©ï¼Œç•™ç©º
            if (date > today) {
                days.push({ type: 'empty' });
                continue;
            }
            
            const dateStr = `${year}-${String(month+1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const count = postsData[dateStr] || 0;
            totalPosts += count;
            
            // è®¡ç®—ç­‰çº§
            let level = 0;
            if (count > 0) {
                if (count === 1) level = 1;
                else if (count === 2) level = 2;
                else if (count <= 4) level = 3;
                else level = 4;
            }
            
            days.push({
                type: 'day',
                date: dateStr,
                count: count,
                level: level
            });
        }
        
        // æŒ‰æ¯7å¤©åˆ†ç»„
        const rows = [];
        for (let j = 0; j < days.length; j += 7) {
            rows.push(days.slice(j, j + 7));
        }
        
        monthGroups.push({
            label: monthLabel,
            rows: rows
        });
        
        // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæœˆ
        current.setMonth(current.getMonth() + 1);
    }
    
    // æ¸²æŸ“è´¡çŒ®å›¾
    const graphEl = document.getElementById('contributions-graph');
    
    monthGroups.forEach(group => {
        const monthGroupEl = document.createElement('div');
        monthGroupEl.className = 'contrib-month-group';
        
        const monthLabelEl = document.createElement('div');
        monthLabelEl.className = 'contrib-month-label';
        monthLabelEl.textContent = group.label;
        monthGroupEl.appendChild(monthLabelEl);
        
        const monthGridEl = document.createElement('div');
        monthGridEl.className = 'contrib-month-grid';
        
        group.rows.forEach(row => {
            row.forEach(day => {
                const cell = document.createElement('div');
                cell.className = 'contrib-cell';
                
                if (day.type === 'empty') {
                    cell.classList.add('empty');
                } else {
                    cell.dataset.level = day.level;
                    cell.dataset.date = day.date;
                    cell.dataset.count = day.count;
                }
                
                monthGridEl.appendChild(cell);
            });
        });
        
        monthGroupEl.appendChild(monthGridEl);
        graphEl.appendChild(monthGroupEl);
    });
    
    // æ˜¾ç¤ºæ€»æ•°
    document.getElementById('contrib-total').textContent = `è¿‡å»ä¸€å¹´å…±å‘å¸ƒ ${totalPosts} ç¯‡å†…å®¹ï¼ˆæ‘˜å½•+æ–‡ç« ï¼‰`;
    
    // Tooltip
    const tooltip = document.createElement('div');
    tooltip.className = 'contrib-tooltip';
    document.body.appendChild(tooltip);
    
    // äº‹ä»¶å§”æ‰˜
    graphEl.addEventListener('mouseover', (e) => {
        const cell = e.target;
        if (cell.classList.contains('contrib-cell') && !cell.classList.contains('empty') && cell.dataset.date) {
            const date = cell.dataset.date;
            const count = cell.dataset.count;
            tooltip.textContent = `${date}: ${count} ç¯‡å†…å®¹`;
            tooltip.classList.add('visible');
        }
    });
    
    graphEl.addEventListener('mousemove', (e) => {
        tooltip.style.left = e.clientX + 10 + 'px';
        tooltip.style.top = e.clientY + 10 + 'px';
    });
    
    graphEl.addEventListener('mouseout', (e) => {
        const cell = e.target;
        if (cell.classList.contains('contrib-cell')) {
            tooltip.classList.remove('visible');
        }
    });
})();
</script>

{{ partial "footer.html" . }}
{{ end }}
